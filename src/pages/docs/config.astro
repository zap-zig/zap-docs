---
import DocsLayout from '../../layouts/DocsLayout.astro';
import Code from '../../components/Code.astro';
---

<DocsLayout title="Configuration" description="zap configuration files">
  <p>zap uses configuration files and directories to manage your projects and Python installations.</p>

  <h2>pyproject.toml</h2>
  <p>Standard Python project configuration file. zap reads and writes the <code>[project]</code> section.</p>
  
  <Code lang="toml" code={`[project]
name = "my-app"
version = "0.1.0"
requires-python = ">= 3.12"
dependencies = [
    "requests",
    "flask",
    "sqlalchemy",
    "mypackage @ git+https://github.com/user/repo",
]`} />

  <p><strong>Fields:</strong></p>
  <table>
    <tr>
      <th>Field</th>
      <th>Description</th>
    </tr>
    <tr>
      <td><code>name</code></td>
      <td>Project name</td>
    </tr>
    <tr>
      <td><code>version</code></td>
      <td>Project version</td>
    </tr>
    <tr>
      <td><code>requires-python</code></td>
      <td>Python version constraint</td>
    </tr>
    <tr>
      <td><code>dependencies</code></td>
      <td>List of package dependencies (PyPI or git URLs)</td>
    </tr>
  </table>

  <h2>zap.lock</h2>
  <p>Lock file that records exact versions of installed packages. Auto-generated, do not edit manually.</p>
  
  <Code lang="toml" code={`# zap.lock - Fast and Safe Python Package Manager
# This file is auto-generated. Do not edit manually.

python = "3.12.1"

[[packages]]
name = "certifi"
version = "2024.2.2"

[[packages]]
name = "requests"
version = "2.31.0"`} />

  <h2>Directory Structure</h2>
  <p>zap uses the following directories:</p>

  <h3>Global Cache</h3>
  <p>Downloaded packages are cached globally:</p>
  <Code lang="text" code={`~/.cache/zap/
  wheels/
    requests-2.31.0/
      requests-2.31.0-py3-none-any.whl
      extracted/
    certifi-2024.2.2/
      certifi-2024.2.2-py3-none-any.whl
      extracted/
  git-mypackage/
    mypackage-1.0.0-py3-none-any.whl`} />

  <h3>Python Installations</h3>
  <p>Managed Python versions are stored at:</p>
  <Code lang="text" code={`~/.zap/python/
  3.12.8/
    bin/
      python3
      pip3
    lib/
      python3.12/
    include/
  3.11.11/
    ...`} />

  <p>List installed versions:</p>
  <Code lang="bash" code="zap python list" />

  <h3>Project Virtual Environment</h3>
  <p>Each project has its own virtual environment at <code>.venv/</code>:</p>
  <Code lang="text" code={`.venv/
  bin/
    python
    pip
    activate
  lib/
    python3.12/
      site-packages/
  pyvenv.cfg`} />

  <h2>Cache Management</h2>
  <p>Manage the global cache with <code>zap cache</code> commands:</p>
  <Code lang="bash" code={`# View cache location and size
zap cache info

# Clear all cached packages
zap cache clean`} />

  <h2>Using the Virtual Environment</h2>
  <p>You can activate it manually if needed:</p>
  <Code lang="bash" code="source .venv/bin/activate" />
  
  <p>But <code>zap run</code> automatically uses the venv, so activation is usually unnecessary.</p>

  <h2>Git Dependencies</h2>
  <p>Git dependencies in <code>pyproject.toml</code> use PEP 440 URL syntax:</p>
  <Code lang="toml" code={`dependencies = [
    # From main branch
    "package @ git+https://github.com/user/repo",
    
    # Specific branch
    "package @ git+https://github.com/user/repo@main",
    
    # Specific tag
    "package @ git+https://github.com/user/repo@v1.0.0",
]`} />

  <p>When adding via CLI, use the <code>git=</code> syntax:</p>
  <Code lang="bash" code={`zap append git=https://github.com/user/repo
zap append git=https://github.com/user/repo@main`} />
</DocsLayout>
